! system.j2

! Name: tor-1a
! Make: cisco
! Model: 93180yc-fx3
hostname tor-1a

banner motd #
NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE

hostname tor-1a
Unauthorized access and/or use prohibited.
All access and/or use subject to monitoring.

NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE
#


no feature telnet
feature scp-server
feature bgp
feature interface-vlan
feature lldp
feature dhcp
feature vpc
feature hsrp
feature lacp
feature ssh
feature tacacs+


clock timezone PST -8 0
clock summer-time PDT 2 Sun Apr 02:00 1 Sun Nov 02:00 60
ntp server [NTP_SERVER_IP]
ntp source-interface [MGMT_VLAN]


logging server [LOG_SERVER_IP] 7 facility local7 use-vrf default
logging source-interface [MGMT_VLAN]
logging level local7 7
no logging console
login on-success log
logging origin-id hostname

logging level acllog 7
logging level aclmgr 7
logging level eth_port_channel 7
logging level hsrp 7
logging level icam 7
logging level interface-vlan 7
logging level ipqosmgr 7
logging level vlan_mgr 7
logging level vpc 7
logging level netstack 7
logging level bgp 7


no cdp enable
lldp tlv-select dcbxp egress-queuing

service dhcp
ip dhcp relay

ip load-sharing address source-destination port source-destination

ip icmp-errors source-interface [MGMT_VLAN]

cli alias name wr copy running-config startup-config


snmp-server community [PLACEHOLDER] ro
snmp-server community [PLACEHOLDER] rW
snmp-server contact "Contact Support"
snmp-server location 

! login.j2

fips mode enable
user max-logins 1
password prompt username
userpassphrase min-length 15 max-length 80
username admin password 0 $CREDENTIAL_PLACEHOLDER$ role network-admin
username $CREDENTIAL_PLACEHOLDER$ password 0 $CREDENTIAL_PLACEHOLDER$ role network-admin


no feature ssh
no ssh key ecdsa
no ssh key rsa
ssh key rsa 2048 force
ssh key ecdsa 256 force
feature ssh


line console
  exec-timeout 10
line vty
  exec-timeout 10
  session-limit 3


! Replace [TACACS_SERVER_IP], [TACACS_KEY], [TACACS_GROUP],[MGMT_VLAN] with actual values.
tacacs-server key [TACACS_KEY]
tacacs-server timeout 2
ip tacacs source-interface [MGMT_VLAN]

tacacs-server host [TACACS_SERVER_IP]
tacacs-server host [TACACS_SERVER_IP]

aaa group server tacacs+ [TACACS_GROUP]
  server [TACACS_SERVER_IP]
  server [TACACS_SERVER_IP]
  source-interface [MGMT_VLAN]

aaa authentication login default group [TACACS_GROUP]
aaa authentication login console group [TACACS_GROUP]
aaa accounting default group [TACACS_GROUP]

! qos.j2

policy-map type network-qos AZLOCAL-NWQOS
  class type network-qos AZLOCAL-NWQOS-RDMA
    pause pfc-cos 3
    mtu 9216
  class type network-qos AZLOCAL-NWQOS-DEFAULT
    mtu 9216
  class type network-qos AZLOCAL-NWQOS-CLUSTER
    mtu 9216


class-map type qos match-all AZLOCAL-QOS-RDMA
  match cos 3
class-map type qos match-all AZLOCAL-QOS-CLUSTER
  match cos 7

policy-map type qos AZLOCAL-QOS-MAP
  class AZLOCAL-QOS-RDMA
    set qos-group 3
  class AZLOCAL-QOS-CLUSTER
    set qos-group 7


policy-map type queuing AZLOCAL-QUEUE-OUT
  class type queuing c-out-8q-q3
    bandwidth remaining percent 50
    random-detect minimum-threshold 300 kbytes maximum-threshold 300 kbytes drop-probability 100 weight 0 ecn
  class type queuing c-out-8q-q-default
    bandwidth remaining percent 48
  class type queuing c-out-8q-q7
    bandwidth percent 2


system qos
  service-policy type network-qos AZLOCAL-NWQOS
  service-policy type queuing output AZLOCAL-QUEUE-OUT

! vlan.j2

vlan 2
  name UNUSED_VLAN
  shutdown
vlan 6
  name HNVPA_6
  
vlan 7
  name Infra_7
  
vlan 99
  name NativeVlan
  
vlan 125
  name BMC_Mgmt_125
  
vlan 201
  name Tenant_201
  
vlan 301
  name LogicalTenant_301
  
vlan 401
  name DhcpTenant_401
  
vlan 501
  name L3forward_501
  
vlan 502
  name L3forward_502
  
vlan 503
  name L3forward_503
  
vlan 504
  name L3forward_504
  
vlan 505
  name L3forward_505
  
vlan 506
  name L3forward_506
  
vlan 507
  name L3forward_507
  
vlan 508
  name L3forward_508
  
vlan 509
  name L3forward_509
  
vlan 510
  name L3forward_510
  
vlan 511
  name L3forward_511
  
vlan 512
  name L3forward_512
  
vlan 513
  name L3forward_513
  
vlan 514
  name L3forward_514
  
vlan 515
  name L3forward_515
  
vlan 516
  name L3forward_516
  
vlan 711
  name Storage_711_TOR1
  
vlan 712
  name Storage_712_TOR2
  


interface vlan6
  description HNVPA_6
  mtu 9216
  no shutdown
  ip address 10.2.1.2/25
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 6
    priority 150
    ip 10.2.1.1

interface vlan7
  description Infra_7
  mtu 9216
  no shutdown
  ip address 10.3.1.2/24
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 7
    priority 150
    ip 10.3.1.1

interface vlan125
  description BMC_Mgmt_125
  mtu 9216
  no shutdown
  ip address 10.1.1.123/26
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 125
    priority 150
    ip 10.1.1.65

interface vlan201
  description Tenant_201
  mtu 9216
  no shutdown
  ip address 10.4.1.2/24
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 201
    priority 150
    ip 10.4.1.1

interface vlan301
  description LogicalTenant_301
  mtu 9216
  no shutdown
  ip address 10.5.2.2/25
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 301
    priority 150
    ip 10.5.2.1

interface vlan401
  description DhcpTenant_401
  mtu 9216
  no shutdown
  ip address 10.5.2.130/25
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 401
    priority 150
    ip 10.5.2.129

interface vlan501
  description L3forward_501
  mtu 9216
  no shutdown
  ip address 10.5.1.2/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 501
    priority 150
    ip 10.5.1.1

interface vlan502
  description L3forward_502
  mtu 9216
  no shutdown
  ip address 10.5.1.18/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 502
    priority 150
    ip 10.5.1.17

interface vlan503
  description L3forward_503
  mtu 9216
  no shutdown
  ip address 10.5.1.34/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 503
    priority 150
    ip 10.5.1.33

interface vlan504
  description L3forward_504
  mtu 9216
  no shutdown
  ip address 10.5.1.50/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 504
    priority 150
    ip 10.5.1.49

interface vlan505
  description L3forward_505
  mtu 9216
  no shutdown
  ip address 10.5.1.66/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 505
    priority 150
    ip 10.5.1.65

interface vlan506
  description L3forward_506
  mtu 9216
  no shutdown
  ip address 10.5.1.82/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 506
    priority 150
    ip 10.5.1.81

interface vlan507
  description L3forward_507
  mtu 9216
  no shutdown
  ip address 10.5.1.98/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 507
    priority 150
    ip 10.5.1.97

interface vlan508
  description L3forward_508
  mtu 9216
  no shutdown
  ip address 10.5.1.114/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 508
    priority 150
    ip 10.5.1.113

interface vlan509
  description L3forward_509
  mtu 9216
  no shutdown
  ip address 10.5.1.130/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 509
    priority 150
    ip 10.5.1.129

interface vlan510
  description L3forward_510
  mtu 9216
  no shutdown
  ip address 10.5.1.145/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 510
    priority 150
    ip 

interface vlan511
  description L3forward_511
  mtu 9216
  no shutdown
  ip address 10.5.1.162/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 511
    priority 150
    ip 10.5.1.161

interface vlan512
  description L3forward_512
  mtu 9216
  no shutdown
  ip address 10.5.1.178/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 512
    priority 150
    ip 10.5.1.177

interface vlan513
  description L3forward_513
  mtu 9216
  no shutdown
  ip address 10.5.1.194/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 513
    priority 150
    ip 10.5.1.193

interface vlan514
  description L3forward_514
  mtu 9216
  no shutdown
  ip address 10.5.1.210/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 514
    priority 150
    ip 10.5.1.209

interface vlan515
  description L3forward_515
  mtu 9216
  no shutdown
  ip address 10.5.1.226/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 515
    priority 150
    ip 10.5.1.225

interface vlan516
  description L3forward_516
  mtu 9216
  no shutdown
  ip address 10.5.1.242/28
  no ip redirects
  no ipv6 redirects
  hsrp version 2
  hsrp 516
    priority 150
    ip 10.5.1.241



! interface.j2

interface Ethernet 1/1-1/54
  description Unused
  no cdp enable
  switchport
  switchport mode access
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  mtu 9216
  shutdown


interface Ethernet 1/49
  description Trunk_TO_BMC_SWITCH
  no cdp enable
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 125
  priority-flow-control mode on send-tlv
  spanning-tree port type edge trunk
  no logging event port link-status
  mtu 9216
  no shutdown

interface Ethernet 1/1-1/16
  description HyperConverged_To_Host
  no cdp enable
  switchport
  switchport mode trunk
  switchport trunk native vlan 7
  switchport trunk allowed vlan 7,6,201,301,401,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,711
  priority-flow-control mode on send-tlv
  spanning-tree port type edge trunk
  no logging event port link-status
  mtu 9216
  service-policy type qos input AZLOCAL-QOS-MAP
  no shutdown


interface Ethernet 1/48
  description P2P_Border1
  no cdp enable
  no switchport
  ip address 10.1.1.2/30
  no ip redirects
  no ipv6 redirects
  mtu 9216
  no shutdown

interface Ethernet 1/47
  description P2P_Border2
  no cdp enable
  no switchport
  ip address 10.1.1.10/30
  no ip redirects
  no ipv6 redirects
  mtu 9216
  no shutdown


interface loopbackloopback0
  description Loopback0
  ip address 10.1.1.21/32
  mtu 9216
  no shutdown



! port-channel.j2


interface port-channel50
  description iBGP_Peer
  no switchport
  ip address 
  logging event port link-status
  mtu 9216
  no shutdown


interface Ethernet 1/41
  description iBGP_Peer
  no cdp enable
  logging event port link-status
  mtu 9216
  channel-group 50 mode active
  no shutdown
  
interface Ethernet 1/42
  description iBGP_Peer
  no cdp enable
  logging event port link-status
  mtu 9216
  channel-group 50 mode active
  no shutdown
  


interface port-channel101
  description ToR_Peer_Link
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 
  spanning-tree port type network
  logging event port link-status
  mtu 9216
  no shutdown


interface Ethernet 1/49
  description ToR_Peer_Link
  no cdp enable
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 
  spanning-tree port type network
  logging event port link-status
  mtu 9216
  channel-group 101 mode active
  no shutdown
  
interface Ethernet 1/50
  description ToR_Peer_Link
  no cdp enable
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 
  spanning-tree port type network
  logging event port link-status
  mtu 9216
  channel-group 101 mode active
  no shutdown
  
interface Ethernet 1/51
  description ToR_Peer_Link
  no cdp enable
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 
  spanning-tree port type network
  logging event port link-status
  mtu 9216
  channel-group 101 mode active
  no shutdown
  




! prefix_list.j2
ip prefix-list DefaultRoute seq 10 permit 0.0.0.0/0
ip prefix-list DefaultRoute seq 50 deny 0.0.0.0/0 le 32




! bgp.j2
router bgp 65242
  router-id 10.1.1.21
  bestpath as-path multipath-relax
  log-neighbor-changes
  address-family ipv4 unicast
    network 10.1.1.2/30
    network 10.1.1.10/30
    network 10.1.1.21/32
    network 10.4.1.0/24
    network 10.5.2.0/25
    network 10.5.2.128/25
    network 10.5.1.0/28
    network 10.5.1.16/28
    network 10.5.1.32/28
    network 10.5.1.48/28
    network 10.5.1.64/28
    network 10.5.1.80/28
    network 10.5.1.96/28
    network 10.5.1.112/28
    network 10.5.1.128/28
    network 10.5.1.144/28
    network 10.5.1.160/28
    network 10.5.1.176/28
    network 10.5.1.192/28
    network 10.5.1.208/28
    network 10.5.1.224/28
    network 10.5.1.240/28
    maximum-paths 8
    maximum-paths ibgp 8
  
  neighbor 10.1.1.1
    description TO_Border1
    remote-as 64846
    address-family ipv4 unicast
      maximum-prefix 12000 warning-only
      prefix-list DefaultRoute in
  
  neighbor 10.1.1.9
    description TO_Border2
    remote-as 64846
    address-family ipv4 unicast
      maximum-prefix 12000 warning-only
      prefix-list DefaultRoute in
  
  neighbor 10.1.1.18
    description iBGP_PEER
    remote-as 65242
    address-family ipv4 unicast
      maximum-prefix 12000 warning-only
  
  neighbor 10.2.1.0/25
    description TO_HNVPA
    remote-as 65112
    update-source Loopback0
    ebgp-multihop 3
    address-family ipv4 unicast
      maximum-prefix 12000 warning-only
      prefix-list DefaultRoute out
  

