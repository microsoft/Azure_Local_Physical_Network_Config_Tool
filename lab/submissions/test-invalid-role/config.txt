! System Configuration - sample-tor1
! Vendor: dellemc
! Model: s5248f-on
! Role: TOR1
! Firmware: os10

hostname sample-tor1

banner motd #
NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE

hostname sample-tor1
Unauthorized access and/or use prohibited.
All access and/or use subject to monitoring.

NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE
#

! Feature Enablement
lldp enable
dcbx enable

! Global System Settings
ztd cancel
mac address-table aging-time 1000000

no ip dhcp-relay information-option
no ip dhcp snooping

vrrp version 3
vrrp delay reload 180

! === LOGIN CONFIGURATION ===
! Replace $CREDENTIAL_PLACEHOLDER$ with actual credentials after generation
password-attributes character-restriction upper 1 lower 1 numeric 1 special-char 1 min-length 15 lockout-period 15 max-retry 3

enable password 0 $CREDENTIAL_PLACEHOLDER$ priv-lvl 15
username admin password $CREDENTIAL_PLACEHOLDER$ role sysadmin

ip ssh server enable
ip ssh server cipher aes256-ctr aes192-ctr aes128-ctr
ip ssh server mac hmac-sha1 hmac-sha2-256
ip ssh server max-auth-tries 3
no ip telnet server enable

login concurrent-session limit 3
login statistics enable

! === QOS CONFIGURATION ===
! DCB/PFC for Azure Local RDMA traffic

wred ecn
  random-detect color green minimum-threshold 150 maximum-threshold 1500 drop-probability 100
  random-detect ecn

class-map type network-qos AZLOCAL_COS3
  match qos-group 3

class-map type network-qos AZLOCAL_COS7
  match qos-group 7

class-map type queuing AZLOCAL_QUEUE0
  match queue 0

class-map type queuing AZLOCAL_QUEUE3
  match queue 3

class-map type queuing AZLOCAL_QUEUE7
  match queue 7

trust dot1p-map AZLOCAL_DOT1P_TRUST
  qos-group 0 dot1p 0-2,4-6
  qos-group 3 dot1p 3
  qos-group 7 dot1p 7

qos-map traffic-class AZLOCAL_QOS_MAP
  queue 0 qos-group 0-2,4-6
  queue 3 qos-group 3
  queue 7 qos-group 7

policy-map type network-qos AZLOCAL_PFC
  class AZLOCAL_COS3
    pause
    pfc-cos 3

policy-map type queuing AZLOCAL_ETS
  class AZLOCAL_QUEUE0
    bandwidth percent 48

  class AZLOCAL_QUEUE3
    bandwidth percent 50
    random-detect ecn

  class AZLOCAL_QUEUE7
    bandwidth percent 2

system qos
  trust-map dot1p AZLOCAL_DOT1P_TRUST
  ets mode on
! VLAN Configuration

interface vlan2
  description UNUSED_VLAN
  shutdown
interface vlan7
  description Mgmt_7
  no shutdown
interface vlan201
  description Compute_201
  no shutdown
interface vlan99
  description Native_99
  no shutdown
interface vlan711
  description Storage1_711
  no shutdown
interface vlan712
  description Storage2_712
  no shutdown

interface vlan7
  description Mgmt_7
  mtu 9216
  no shutdown
  ip address 192.0.2.2/24

  vrrp-group 7
    priority 150
    virtual-address 192.0.2.1

interface vlan201
  description Compute_201
  mtu 9216
  no shutdown
  ip address 198.51.100.2/24

  vrrp-group 201
    priority 150
    virtual-address 198.51.100.1


! Interface Configuration

interface loopback loopback0
  description Loopback0
  ip address 203.0.113.1/32
  mtu 9216
  no shutdown

interface Ethernet 1/1/47
  description P2P_Border1
  no switchport
  ip address 198.51.100.6/30
  mtu 9216
  no shutdown
interface Ethernet 1/1/48
  description P2P_Border2
  no switchport
  ip address 198.51.100.10/30
  mtu 9216
  no shutdown

interface Ethernet 1/1/1-1/1/16
  description Host_Trunk
  switchport
  switchport mode trunk
  switchport access vlan 7
  switchport trunk allowed vlan 7,201,711,712
  spanning-tree bpduguard enable
  spanning-tree guard root
  spanning-tree port type edge
  mtu 9216
  flowcontrol receive off
  priority-flow-control mode on
  ets mode on
  service-policy input type network-qos AZLOCAL_PFC
  service-policy output type queuing AZLOCAL_ETS
  no shutdown


! Port-Channel Configuration

interface port-channel101
  description MLAG_Peer_Link
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 7,201
  priority-flow-control mode on
  spanning-tree port type network
  logging event port link-status
  vlt-port-channel 101
  mtu 9216
  no shutdown

interface ethernet 1/1/49
  description MLAG_Peer_Link
  mtu 9216
  flowcontrol receive off
  priority-flow-control mode on
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 7,201
  spanning-tree port type network
  channel-group 101 mode active
  no shutdown
interface ethernet 1/1/50
  description MLAG_Peer_Link
  mtu 9216
  flowcontrol receive off
  priority-flow-control mode on
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 7,201
  spanning-tree port type network
  channel-group 101 mode active
  no shutdown
interface ethernet 1/1/51
  description MLAG_Peer_Link
  mtu 9216
  flowcontrol receive off
  priority-flow-control mode on
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 7,201
  spanning-tree port type network
  channel-group 101 mode active
  no shutdown
interface ethernet 1/1/52
  description MLAG_Peer_Link
  mtu 9216
  flowcontrol receive off
  priority-flow-control mode on
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  switchport trunk allowed vlan 7,201
  spanning-tree port type network
  channel-group 101 mode active
  no shutdown
interface port-channel50
  description iBGP_Peer_Link
  no switchport
  priority-flow-control mode on
  ip address 203.0.113.2/30
  mtu 9216
  no shutdown

interface ethernet 1/1/39
  description iBGP_Peer_Link
  mtu 9216
  flowcontrol receive off
  priority-flow-control mode on
  channel-group 50 mode active
  no shutdown
interface ethernet 1/1/40
  description iBGP_Peer_Link
  mtu 9216
  flowcontrol receive off
  priority-flow-control mode on
  channel-group 50 mode active
  no shutdown

! MLAG (VLT) Configuration

vlt domain 1
  peer-routing
  primary-priority 1
  back-up destination 192.0.2.3


! BGP Configuration

router bgp 65001
  router-id 203.0.113.1
  bestpath as-path multipath-relax
  log-neighbor-changes
  maximum-paths 8
  maximum-paths ibgp 8
  address-family ipv4 unicast
    network 192.0.2.0/24
    network 198.51.100.0/24
  neighbor 198.51.100.5
    description TO_BORDER1
    remote-as 65010
    no shutdown
    address-family ipv4 unicast
      activate
      sender-side-loop-detection
  neighbor 198.51.100.9
    description TO_BORDER2
    remote-as 65010
    no shutdown
    address-family ipv4 unicast
      activate
      sender-side-loop-detection

