<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Local Switch Configuration Wizard</title>
    <link rel="stylesheet" href="/style-odin.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div>
                <h1>Azure Local Switch Configuration</h1>
                <p class="subtitle">Generate Standard JSON configurations for Azure Local ToR switches. Pattern-driven wizard with real-time validation.</p>
            </div>
            <div class="import-section">
                <button class="import-btn" onclick="showTemplateModal()">üìã Load Template</button>
                <label for="import-json" class="import-btn">üì• Import JSON</label>
                <input type="file" id="import-json" accept=".json" style="display: none;">
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Validation Messages -->
        <div id="validation-error" class="message error-message" style="display: none;"></div>
        <div id="success-message" class="message success-message" style="display: none;"></div>

        <!-- Template Selection Modal -->
        <div id="template-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìã Example Configuration Templates</h2>
                    <button class="modal-close" onclick="closeTemplateModal()">√ó</button>
                </div>
                <p class="modal-description">Select a pre-configured example template organized by deployment pattern. These templates include all required settings.</p>
                
                <div id="template-list"></div>
            </div>
        </div>

        <!-- Top Navigation Bar (3-Phase) -->
        <nav class="top-nav">
            <div class="nav-phase active" data-phase="1">
                <div class="phase-number">1</div>
                <div class="phase-label">Pattern & Switch</div>
            </div>
            <div class="nav-phase" data-phase="2">
                <div class="phase-number">2</div>
                <div class="phase-label">Network</div>
                <div class="sub-steps">
                    <span class="sub-step" data-step="2.1">VLANs</span>
                    <span class="sub-step" data-step="2.2">Ports</span>
                    <span class="sub-step" data-step="2.3">Redundancy</span>
                    <span class="sub-step" data-step="2.4">Uplinks</span>
                </div>
            </div>
            <div class="nav-phase" data-phase="3">
                <div class="phase-number">3</div>
                <div class="phase-label">Routing</div>
            </div>
            <div class="nav-phase" data-phase="review">
                <div class="phase-number">‚úì</div>
                <div class="phase-label">Review</div>
            </div>
        </nav>

        <!-- Persistent Pattern Sidebar -->
        <aside id="pattern-sidebar" class="pattern-sidebar" style="display: none;">
            <div class="sidebar-thumbnail">
                <img id="sidebar-pattern-img" src="" alt="Selected pattern" onclick="expandPatternImage()" style="cursor: zoom-in;">
            </div>
            <div class="sidebar-info">
                <strong id="sidebar-pattern-name"></strong>
                <a href="https://github.com/Azure/AzureLocal-Supportability/blob/main/TSG/Networking/Top-Of-Rack-Switch/Overview-Azure-Local-Deployment-Pattern.md" target="_blank" style="font-size: 12px; color: #667eea; text-decoration: none; display: block; margin-top: 5px;">üìñ Deployment Pattern Overview</a>
            </div>
            <button class="change-pattern-btn" onclick="startOver()">Start Over</button>
        </aside>

        <!-- Lightbox for Pattern Image -->
        <div id="pattern-lightbox" class="lightbox" style="display: none;" onclick="closeLightbox()">
            <span class="lightbox-close">√ó</span>
            <img id="lightbox-img" src="" alt="Pattern topology">
        </div>

        <!-- Main Content + Config Summary Layout -->
        <div class="main-layout">
            <!-- Wizard Container -->
            <div class="wizard-container">
            <!-- ================================================================
                 PHASE 1: PATTERN & SWITCH
                 Pattern FIRST with visual cards, then hardware, role, hostname
                 ================================================================ -->
            <section id="phase1" class="phase active">
                <h2>Phase 1: Pattern & Switch</h2>
                <p class="description">Start by selecting your deployment pattern</p>
                
                <!-- 1.1 Pattern Selection (FIRST - Visual Cards) -->
                <section class="form-section pattern-selection">
                    <h3>1.1 Select Deployment Pattern <span class="required">*</span></h3>
                    <p class="section-help">Choose how storage traffic flows in your Azure Local deployment <a href="https://github.com/Azure/AzureLocal-Supportability/blob/main/TSG/Networking/Top-Of-Rack-Switch/Overview-Azure-Local-Deployment-Pattern.md" target="_blank" class="section-link">üìñ Deployment Pattern Overview</a></p>
                    
                    <div class="pattern-cards">
                        <div class="pattern-card" data-pattern="switchless" onclick="selectPattern('switchless')">
                            <img src="media/pattern-switchless.png" alt="Switchless topology" onclick="event.stopPropagation(); expandPatternPreview(this.src, this.alt)">
                            <h4>üîå Switchless</h4>
                            <p>Storage direct host-to-host. Edge/cost-sensitive deployments.</p>
                            <span class="pattern-tag">VLANs: Management, Compute only</span>
                        </div>
                        
                        <div class="pattern-card" data-pattern="switched" onclick="selectPattern('switched')">
                            <img src="media/pattern-switched.png" alt="Switched topology" onclick="event.stopPropagation(); expandPatternPreview(this.src, this.alt)">
                            <h4>üíæ Switched</h4>
                            <p>Storage on dedicated switch ports. Enterprise isolation with separate storage network.</p>
                            <span class="pattern-tag">VLANs: Management, Compute, Storage 1 or Storage 2</span>
                        </div>
                        
                        <div class="pattern-card" data-pattern="fully_converged" onclick="selectPattern('fully_converged')">
                            <img src="media/pattern-fully-converged.png" alt="Fully Converged topology" onclick="event.stopPropagation(); expandPatternPreview(this.src, this.alt)">
                            <h4>üîÑ Fully Converged</h4>
                            <p>All traffic on shared ports. General purpose and most common deployment pattern.</p>
                            <span class="pattern-tag">VLANs: Management, Compute, Storage 1, Storage 2</span>
                        </div>
                    </div>
                </section>
                
                <!-- 1.2 Hardware Selection (dropdowns, hidden until pattern selected) -->
                <section class="form-section hardware-selection">
                    <h3>1.2 Select Hardware <span class="required">*</span></h3>
                    <div class="form-container">
                        <div class="form-group">
                            <label>Vendor <span class="required">*</span></label>
                            <select id="vendor-select" onchange="onVendorChange()">
                                <option value="">-- Select Vendor --</option>
                                <option value="cisco">Cisco</option>
                                <option value="dellemc">Dell EMC</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Model <span class="required">*</span></label>
                            <select id="model-select" onchange="onModelChange()" disabled>
                                <option value="">-- Select Vendor First --</option>
                            </select>
                        </div>
                    </div>
                </section>
                
                <!-- 1.3 Role Selection (hidden until hardware selected) -->
                <section class="form-section role-selection" id="role-selection-section">
                    <h3>1.3 Select Role <span class="required">*</span></h3>
                    <div class="role-cards">
                        <div class="role-card" data-role="TOR1" onclick="selectRole('TOR1')">
                            <h4>üîµ TOR1</h4>
                        </div>
                        <div class="role-card" data-role="TOR2" onclick="selectRole('TOR2')">
                            <h4>üü¢ TOR2</h4>
                        </div>
                    </div>
                </section>
                
                <!-- 1.4 Hostname (shown after role selected) -->
                <section class="form-section hostname-section" id="hostname-section">
                    <h3>1.4 Hostname <span class="required">*</span></h3>
                    <div class="form-container">
                        <div class="form-group">
                            <label>Hostname <span class="required">*</span></label>
                            <input type="text" id="hostname" placeholder="Auto-generated based on role" oninput="updateHostname()" autocomplete="off">
                            <small>Edit if needed, or leave as auto-generated</small>
                        </div>
                    </div>
                </section>
                
                <div class="btn-group">
                    <div></div>
                    <button class="btn-next" id="phase1-next-btn" onclick="nextPhase()">Next: Network Configuration ‚Üí</button>
                </div>
            </section>

            <!--================================================================
                 PHASE 2: NETWORK CONFIGURATION  
                 Consolidates former Steps 2-5 into sub-steps 2.1-2.4
                 ================================================================ -->
            <section id="phase2" class="phase">
                <h2>Phase 2: Network Configuration</h2>
                <p class="description">Configure VLANs, ports, and redundancy</p>
                
                <!-- Sub-navigation for Phase 2 -->
                <div class="sub-nav">
                    <button class="sub-nav-btn active" data-substep="2.1">2.1 VLANs</button>
                    <button class="sub-nav-btn" data-substep="2.2">2.2 Host Ports</button>
                    <button class="sub-nav-btn" data-substep="2.3">2.3 Redundancy</button>
                </div>

                <!-- 2.1 VLANs -->
                <div class="substep active" data-substep="2.1">
                    <h3>2.1 VLANs</h3>
                    <p class="substep-description">Define your network VLANs</p>
                
                <div class="form-container">
                    <!-- Unused Port VLAN (Static) -->
                    <div class="vlan-card">
                        <h3>üö´ Unused Port VLAN (Shutdown)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>VLAN ID</label>
                                <input type="number" id="vlan-parking-id" value="2" min="2" max="4094">
                                <small>Unused ports assigned here (shutdown=true)</small>
                            </div>
                        </div>
                    </div>

                    <!-- Management VLANs (Dynamic) -->
                    <div class="vlan-section">
                        <div class="section-header">
                            <h3>üì° Management VLANs <span class="required">*</span></h3>
                            <button type="button" class="btn-add-small" id="btn-add-mgmt">+ Add Management VLAN</button>
                        </div>
                        <div id="mgmt-vlans-container">
                            <div class="vlan-card dynamic-vlan" data-vlan-type="management" data-vlan-index="0">
                                <div class="card-header">
                                    <h4>Management VLAN #1</h4>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>VLAN ID <span class="required">*</span></label>
                                        <input type="number" class="vlan-mgmt-id" value="7" min="2" max="4094" onchange="updateVlanName(this, 'mgmt', 'Infra')">
                                    </div>
                                    <div class="form-group">
                                        <label>VLAN Name</label>
                                        <input type="text" class="vlan-mgmt-name" value="Infra_7" placeholder="Infra_7" style="color: #666;">
                                        <small>Optional - defaults to Infra_{vlan_id}</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Switch IP</label>
                                        <input type="text" class="vlan-mgmt-ip" placeholder="192.0.2.2/24">
                                    </div>
                                    <div class="form-group">
                                        <label>Gateway VIP (HSRP/VRRP)</label>
                                        <input type="text" class="vlan-mgmt-gateway" placeholder="192.0.2.1/24">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>DHCP Relay (optional, comma-separated)</label>
                                    <input type="text" class="vlan-mgmt-dhcp" placeholder="192.0.2.53,192.0.2.54">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Compute VLANs (Dynamic) -->
                    <div class="vlan-section">
                        <div class="section-header">
                            <h3>üíª Compute VLANs <span class="required">*</span></h3>
                            <button type="button" class="btn-add-small" id="btn-add-compute">+ Add Compute VLAN</button>
                        </div>
                        <div id="compute-vlans-container">
                            <div class="vlan-card dynamic-vlan" data-vlan-type="compute" data-vlan-index="0">
                                <div class="card-header">
                                    <h4>Compute VLAN #1</h4>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>VLAN ID <span class="required">*</span></label>
                                        <input type="number" class="vlan-compute-id" value="201" min="2" max="4094" onchange="updateVlanName(this, 'compute', 'Compute')">
                                    </div>
                                    <div class="form-group">
                                        <label>VLAN Name</label>
                                        <input type="text" class="vlan-compute-name" value="Compute_201" placeholder="Compute_201" style="color: #666;">
                                        <small>Optional - defaults to Compute_{vlan_id}</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Switch IP</label>
                                        <input type="text" class="vlan-compute-ip" placeholder="198.51.100.2/24">
                                    </div>
                                    <div class="form-group">
                                        <label>Gateway VIP (HSRP/VRRP)</label>
                                        <input type="text" class="vlan-compute-gateway" placeholder="198.51.100.1/24">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>DHCP Relay (optional, comma-separated)</label>
                                    <input type="text" class="vlan-compute-dhcp" placeholder="192.0.2.53,192.0.2.54">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Storage VLANs (Static) -->
                    <div class="vlan-card">
                        <h3>üíæ Storage VLANs <span class="optional-badge">L2 Only</span></h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Storage 1 VLAN ID</label>
                                <input type="number" id="vlan-storage1-id" placeholder="711" min="2" max="4094" onchange="updateStorageVlanName(1)">
                            </div>
                            <div class="form-group">
                                <label>Storage 1 Name</label>
                                <input type="text" id="vlan-storage1-name" value="Storage1_711" placeholder="Storage1_711" style="color: #666;">
                                <small>Optional - defaults to Storage1_{vlan_id}</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Storage 2 VLAN ID</label>
                                <input type="number" id="vlan-storage2-id" placeholder="712" min="2" max="4094" onchange="updateStorageVlanName(2)">
                            </div>
                            <div class="form-group">
                                <label>Storage 2 Name</label>
                                <input type="text" id="vlan-storage2-name" value="Storage2_712" placeholder="Storage2_712" style="color: #666;">
                                <small>Optional - defaults to Storage2_{vlan_id}</small>
                            </div>
                        </div>
                    </div>

                    <!-- BMC VLAN (for BMC switch only) - Optional & Collapsed -->
                    <div class="vlan-card collapsible" id="vlan-bmc-section">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <h3>üñ•Ô∏è BMC VLAN <span class="optional-badge">Optional - Lab/BMC Switch Only</span></h3>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="collapsible-content" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>VLAN ID</label>
                                    <input type="number" id="vlan-bmc-id" placeholder="125" min="2" max="4094">
                                </div>
                                <div class="form-group">
                                    <label>VLAN Name</label>
                                    <input type="text" id="vlan-bmc-name" placeholder="BMC_125">
                                    <small>Optional - defaults to BMC_{vlan_id}</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Switch IP</label>
                                    <input type="text" id="vlan-bmc-ip" placeholder="192.0.2.68">
                                </div>
                                <div class="form-group">
                                    <label>CIDR</label>
                                    <input type="number" id="vlan-bmc-cidr" value="26" min="1" max="32">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Gateway (Virtual IP)</label>
                                <input type="text" id="vlan-bmc-gateway" placeholder="192.0.2.65">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End 2.1 VLANs -->
                
                <div class="btn-group">
                    <button class="btn-back" onclick="previousPhase()">‚Üê Back</button>
                    <button class="btn-next" onclick="nextSubstep()">Next: Host Ports ‚Üí</button>
                </div>
                </div>

                <!-- 2.2 Host Ports -->
                <div class="substep" data-substep="2.2">
                    <h3>2.2 Host Port Assignment</h3>
                    <p class="substep-description">Configure host-facing trunk ports</p>
                
                <div class="form-container">
                    <!-- Deployment Pattern Info -->
                    <div class="info-box" style="margin-bottom: 20px;">
                        <strong>Deployment Pattern:</strong> <span id="deployment-pattern-display">fully_converged</span><br>
                        <small>Port configuration adapts based on your selected deployment pattern from Step 1</small>
                    </div>

                    <!-- Fully Converged: Single port group with all VLANs -->
                    <div class="port-card" id="port-section-converged">
                        <h3>üñ•Ô∏è Host-Facing Trunk Ports (Fully Converged)</h3>
                        <p class="section-note">All VLANs (Management + Compute + Storage) on same ports</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Port <span class="required">*</span></label>
                                <input type="text" id="intf-converged-start" value="1/1/1" placeholder="1/1/1">
                            </div>
                            <div class="form-group">
                                <label>End Port <span class="required">*</span></label>
                                <input type="text" id="intf-converged-end" value="1/1/16" placeholder="1/1/16">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="intf-converged-qos" checked>
                                <span>Enable QoS (for RDMA/RoCE traffic)</span>
                            </label>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Native/Untagged VLAN</label>
                                <input type="number" id="intf-converged-native" placeholder="7" min="2" max="4094">
                                <small>Usually management VLAN</small>
                            </div>
                            <div class="form-group">
                                <label>Tagged VLANs (comma-separated)</label>
                                <input type="text" id="intf-converged-tagged" placeholder="7,201,711,712" style="font-family: monospace;">
                                <small id="converged-vlans-hint" style="color: #4CAF50;">Auto-populated from Step 2</small>
                            </div>
                        </div>
                    </div>

                    <!-- Storage Switched: Separate mgmt/compute and storage ports -->
                    <div class="port-card" id="port-section-mgmt-compute" style="display: none;">
                        <h3>üñ•Ô∏è Management + Compute Ports</h3>
                        <p class="section-note">Ports for management and compute VLANs only</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Port <span class="required">*</span></label>
                                <input type="text" id="intf-mgmt-compute-start" value="1/1/1" placeholder="1/1/1">
                            </div>
                            <div class="form-group">
                                <label>End Port <span class="required">*</span></label>
                                <input type="text" id="intf-mgmt-compute-end" value="1/1/16" placeholder="1/1/16">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Native/Untagged VLAN</label>
                                <input type="number" id="intf-mgmt-compute-native" placeholder="7" min="2" max="4094">
                                <small>Usually management VLAN</small>
                            </div>
                            <div class="form-group">
                                <label>Tagged VLANs (comma-separated)</label>
                                <input type="text" id="intf-mgmt-compute-tagged" placeholder="7,201" style="font-family: monospace;">
                                <small id="mgmt-compute-vlans-hint" style="color: #4CAF50;">Auto-populated from Step 2</small>
                            </div>
                        </div>
                    </div>

                    <div class="port-card" id="port-section-storage1" style="display: none;">
                        <h3>üíæ Storage Trunk Ports (TOR1 ‚Üí Storage Network 1)</h3>
                        <p class="section-note">TOR1 only: Dedicated trunk ports for Storage VLAN 711 traffic</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Port <span class="required">*</span></label>
                                <input type="text" id="intf-storage1-start" value="1/1/17" placeholder="1/1/17">
                            </div>
                            <div class="form-group">
                                <label>End Port <span class="required">*</span></label>
                                <input type="text" id="intf-storage1-end" value="1/1/18" placeholder="1/1/18">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="intf-storage1-qos" checked>
                                <span>Enable QoS (for RDMA/RoCE traffic)</span>
                            </label>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Native/Untagged VLAN</label>
                                <input type="number" id="intf-storage1-native" value="99" placeholder="99" min="2" max="4094">
                                <small>Dummy/unused VLAN (default: 99)</small>
                            </div>
                            <div class="form-group">
                                <label>Tagged VLAN</label>
                                <input type="text" id="intf-storage1-tagged" value="711" placeholder="711" style="font-family: monospace;">
                                <small id="storage1-vlans-hint" style="color: #4CAF50;">Storage VLAN 1 only</small>
                            </div>
                        </div>
                    </div>

                    <div class="port-card" id="port-section-storage2" style="display: none;">
                        <h3>üíæ Storage Trunk Ports (TOR2 ‚Üí Storage Network 2)</h3>
                        <p class="section-note">TOR2 only: Dedicated trunk ports for Storage VLAN 712 traffic</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Port <span class="required">*</span></label>
                                <input type="text" id="intf-storage2-start" value="1/1/19" placeholder="1/1/19">
                            </div>
                            <div class="form-group">
                                <label>End Port <span class="required">*</span></label>
                                <input type="text" id="intf-storage2-end" value="1/1/20" placeholder="1/1/20">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="intf-storage2-qos" checked>
                                <span>Enable QoS (for RDMA/RoCE traffic)</span>
                            </label>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Native/Untagged VLAN</label>
                                <input type="number" id="intf-storage2-native" value="99" placeholder="99" min="2" max="4094">
                                <small>Dummy/unused VLAN (default: 99)</small>
                            </div>
                            <div class="form-group">
                                <label>Tagged VLAN</label>
                                <input type="text" id="intf-storage2-tagged" value="712" placeholder="712" style="font-family: monospace;">
                                <small id="storage2-vlans-hint" style="color: #4CAF50;">Storage VLAN 2 only</small>
                            </div>
                        </div>
                    </div>

                    <!-- Switchless: Only mgmt/compute ports -->
                    <div class="port-card" id="port-section-switchless" style="display: none;">
                        <h3>üñ•Ô∏è Management + Compute Ports (Switchless)</h3>
                        <p class="section-note">No storage network - only management and compute VLANs</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Port <span class="required">*</span></label>
                                <input type="text" id="intf-switchless-start" value="1/1/1" placeholder="1/1/1">
                            </div>
                            <div class="form-group">
                                <label>End Port <span class="required">*</span></label>
                                <input type="text" id="intf-switchless-end" value="1/1/16" placeholder="1/1/16">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Native/Untagged VLAN</label>
                                <input type="number" id="intf-switchless-native" placeholder="7" min="2" max="4094">
                                <small>Usually management VLAN</small>
                            </div>
                            <div class="form-group">
                                <label>Tagged VLANs (comma-separated)</label>
                                <input type="text" id="intf-switchless-tagged" placeholder="7,201" style="font-family: monospace;">
                                <small id="switchless-vlans-hint" style="color: #4CAF50;">Management + Compute only</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn-back" onclick="previousSubstep()">‚Üê Back</button>
                    <button class="btn-next" onclick="nextSubstep()">Next: Redundancy ‚Üí</button>
                </div>
                </div>

                <!-- 2.3 Redundancy -->
                <div class="substep" data-substep="2.3">
                    <h3>2.3 Redundancy Configuration</h3>
                    <p class="substep-description">Configure MLAG/VPC for switch redundancy</p>
                
                <div class="form-container">
                    <!-- MLAG/VPC Section -->
                    <div class="port-card" id="mlag-section">
                        <h3>üîó Switch Redundancy - MLAG/VPC</h3>
                        <p class="section-note">TOR1/TOR2 only. BMC switches skip this step.</p>
                        
                        <div class="info-box">
                            <strong>Peer-Link Port-Channel (Editable):</strong><br>
                            <small>Loaded from template, but you can adjust if needed.</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Peer-Link Port-Channel ID</label>
                                <input type="number" id="mlag-peerlink-id" value="101" min="1" max="4096">
                            </div>
                            <div class="form-group">
                                <label>Peer-Link Members (comma-separated)</label>
                                <input type="text" id="mlag-peerlink-members" value="1/1/49,1/1/50,1/1/51,1/1/52">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Keepalive Source IP <span class="required">*</span></label>
                                <input type="text" id="mlag-keepalive-src" placeholder="192.0.2.10">
                                <small>This switch's management IP</small>
                            </div>
                            <div class="form-group">
                                <label>Keepalive Destination IP <span class="required">*</span></label>
                                <input type="text" id="mlag-keepalive-dst" placeholder="192.0.2.11">
                                <small>Peer switch's management IP</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>MLAG Domain ID</label>
                            <input type="number" id="mlag-domain-id" value="1" min="1" max="4095">
                        </div>
                    </div>

                    <!-- iBGP Port-Channel (TOR only) -->
                    <div class="port-card" id="pc-ibgp-section">
                        <h3>üîó iBGP Peer-Link Port-Channel</h3>
                        <p class="section-note">For iBGP routing between TOR1/TOR2 pair</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Port-Channel ID</label>
                                <input type="number" id="pc-ibgp-id" value="50" min="1" max="4096">
                            </div>
                            <div class="form-group">
                                <label>Port-Channel IP (CIDR)</label>
                                <input type="text" id="pc-ibgp-ip" placeholder="203.0.113.2/30">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Member Ports (comma-separated)</label>
                            <input type="text" id="pc-ibgp-members" value="1/1/39,1/1/40" placeholder="1/1/39,1/1/40">
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn-back" onclick="previousSubstep()">‚Üê Back</button>
                    <button class="btn-next" onclick="nextPhase()">Next: Routing ‚Üí</button>
                </div>
                </div>
            </section>

            <!-- ================================================================
                 PHASE 3: ROUTING CONFIGURATION
                 Includes Uplinks (border links + loopback) and BGP/Static routing
                 ================================================================ -->
            <section id="phase3" class="phase">
                <h2>Phase 3: Routing Configuration</h2>
                <p class="description">Configure uplinks, loopback, and routing protocol</p>
                
                <div class="form-container">
                    <!-- Border Uplinks -->
                    <div class="port-card">
                        <h3>üåê Border Uplink Ports - L3</h3>
                        <p class="section-note">Point-to-point links to border/spine switches. These IPs are used as BGP neighbors.</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Uplink 1 Port</label>
                                <input type="text" id="intf-uplink1-port" value="1/1/47" placeholder="1/1/47">
                            </div>
                            <div class="form-group">
                                <label>Uplink 1 IP (CIDR)</label>
                                <input type="text" id="intf-uplink1-ip" placeholder="198.51.100.2/30">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Uplink 2 Port</label>
                                <input type="text" id="intf-uplink2-port" value="1/1/48" placeholder="1/1/48">
                            </div>
                            <div class="form-group">
                                <label>Uplink 2 IP (CIDR)</label>
                                <input type="text" id="intf-uplink2-ip" placeholder="198.51.100.6/30">
                            </div>
                        </div>
                    </div>

                    <!-- Loopback Interface -->
                    <div class="port-card">
                        <h3>üîÑ Loopback Interface</h3>
                        <p class="section-note">Used as BGP router-id</p>
                        
                        <div class="form-group">
                            <label>Loopback0 IP (CIDR) <span class="required">*</span></label>
                            <input type="text" id="intf-loopback-ip" placeholder="203.0.113.1/32">
                            <small>Must be /32 (single host)</small>
                        </div>
                    </div>

                    <!-- Routing Type Selection -->
                    <div class="form-group">
                        <label>Routing Type</label>
                        <div class="cards inline">
                            <div class="card small routing-card selected" data-routing="bgp">
                                <h4>üì° BGP</h4>
                            </div>
                            <div class="card small routing-card" data-routing="static">
                                <h4>üìã Static</h4>
                            </div>
                        </div>
                    </div>

                    <!-- BGP Configuration -->
                    <div id="bgp-section" class="bgp-card">
                        <h3>üîß BGP Configuration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Local ASN <span class="required">*</span></label>
                                <input type="number" id="bgp-asn" placeholder="65001">
                            </div>
                            <div class="form-group">
                                <label>Router ID</label>
                                <input type="text" id="bgp-router-id" placeholder="203.0.113.1">
                                <small>Auto-filled from Loopback0, editable if needed</small>
                            </div>
                        </div>

                        <h4>BGP Neighbors</h4>
                        <p class="section-note">Add eBGP neighbors to border/spine switches</p>
                        
                        <div id="bgp-neighbors">
                            <!-- Neighbor entries will be added here -->
                        </div>
                        <button type="button" class="btn-add" id="btn-add-neighbor">+ Add BGP Neighbor</button>
                    </div>

                    <!-- Static Routes Configuration -->
                    <div id="static-section" class="bgp-card" style="display: none;">
                        <h3>üìã Static Routes</h3>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="static-default-enabled" checked>
                                <span>Add default route (0.0.0.0/0)</span>
                            </label>
                        </div>
                        <div class="form-group" id="static-default-group">
                            <label>Default Route Next-Hop</label>
                            <input type="text" id="static-default-nexthop" placeholder="203.0.113.254">
                        </div>
                        <div id="static-routes-list"></div>
                        <button type="button" class="btn-add" id="btn-add-route">+ Add Route</button>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn-back" onclick="previousPhase()">‚Üê Back</button>
                    <button class="btn-next" onclick="nextPhase()">Review & Export ‚Üí</button>
                </div>
            </section>

            <!-- ================================================================
                 REVIEW & EXPORT
                 Final step - unchanged
                 ================================================================ -->
            <section id="review" class="phase">
                <h2>‚úÖ Configuration Ready</h2>
                <p class="description">Review your configuration and export Standard JSON</p>
                
                <div class="summary-container">
                    <div id="config-summary" class="config-summary"></div>
                </div>

                <div class="preview-container">
                    <h3>üìÑ Standard JSON Preview</h3>
                    <pre id="json-preview"></pre>
                </div>
                
                <div class="export-buttons">
                    <button class="btn-export" id="btn-export">üíæ Export JSON</button>
                    <button class="btn-export secondary" id="btn-copy">üìã Copy to Clipboard</button>
                    <button class="btn-reset" id="btn-reset">üîÑ Start Over</button>
                </div>
            </section>
        </div>

            <!-- Configuration Summary Sidebar -->
            <aside id="config-summary-sidebar" class="config-summary-sidebar">
                <div class="sidebar-header">
                    <h3>üìã Configuration Summary</h3>
                    <div class="progress-indicator">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="progress-text">0%</span>
                    </div>
                </div>
                
                <div class="sidebar-content">
                    <!-- Switch Section -->
                    <div class="summary-section" id="summary-switch">
                        <h4>üîß SWITCH</h4>
                        <div class="summary-grid">
                            <span class="summary-label">Pattern</span>
                            <span class="summary-value" id="sum-pattern">‚Äî</span>
                            <span class="summary-label">Vendor</span>
                            <span class="summary-value" id="sum-vendor">‚Äî</span>
                            <span class="summary-label">Model</span>
                            <span class="summary-value" id="sum-model">‚Äî</span>
                            <span class="summary-label">Role</span>
                            <span class="summary-value" id="sum-role">‚Äî</span>
                            <span class="summary-label">Hostname</span>
                            <span class="summary-value" id="sum-hostname">‚Äî</span>
                        </div>
                    </div>

                    <!-- VLANs Section -->
                    <div class="summary-section" id="summary-vlans">
                        <h4>üè∑Ô∏è VLANS</h4>
                        <div class="summary-grid">
                            <span class="summary-label">Management</span>
                            <span class="summary-value" id="sum-vlan-mgmt">‚Äî</span>
                            <span class="summary-label">Compute</span>
                            <span class="summary-value" id="sum-vlan-compute">‚Äî</span>
                            <span class="summary-label">Storage 1</span>
                            <span class="summary-value" id="sum-vlan-storage1">‚Äî</span>
                            <span class="summary-label">Storage 2</span>
                            <span class="summary-value" id="sum-vlan-storage2">‚Äî</span>
                        </div>
                    </div>

                    <!-- Host Ports Section -->
                    <div class="summary-section" id="summary-ports">
                        <h4>üîå HOST PORTS</h4>
                        <div class="summary-grid">
                            <span class="summary-label">Port Range</span>
                            <span class="summary-value" id="sum-port-range">‚Äî</span>
                            <span class="summary-label">Tagged VLANs</span>
                            <span class="summary-value" id="sum-tagged-vlans">‚Äî</span>
                        </div>
                    </div>

                    <!-- Redundancy Section -->
                    <div class="summary-section" id="summary-redundancy">
                        <h4>üîó REDUNDANCY</h4>
                        <div class="summary-grid">
                            <span class="summary-label">Peer-Link PC</span>
                            <span class="summary-value" id="sum-peerlink">‚Äî</span>
                            <span class="summary-label">Keepalive</span>
                            <span class="summary-value" id="sum-keepalive">‚Äî</span>
                        </div>
                    </div>

                    <!-- Routing Section -->
                    <div class="summary-section" id="summary-routing">
                        <h4>üì° ROUTING</h4>
                        <div class="summary-grid">
                            <span class="summary-label">Type</span>
                            <span class="summary-value" id="sum-routing-type">‚Äî</span>
                            <span class="summary-label">ASN</span>
                            <span class="summary-value" id="sum-asn">‚Äî</span>
                            <span class="summary-label">Router ID</span>
                            <span class="summary-value" id="sum-router-id">‚Äî</span>
                            <span class="summary-label">Neighbors</span>
                            <span class="summary-value" id="sum-neighbors">‚Äî</span>
                        </div>
                    </div>
                </div>
            </aside>
        </div> <!-- End main-layout -->
    </div>

    <script type="module" src="/src/main.ts"></script>
</body>
</html>
